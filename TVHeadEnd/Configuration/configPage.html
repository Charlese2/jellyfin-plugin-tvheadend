<!DOCTYPE html>
<html>

<head>
    <title>TVHeadEnd</title>
</head>

<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage TVHclientConfigurationPage">
        <div data-role="content">
            <div class="content-primary">
                <form class="TVHclientConfigurationForm">
                    <div class="inputContainer">
                        <label for="txtTVH_ServerName" class="inputLabel">TVHeadend Hostname or IP Address</label>
                        <input type="text" id="txtTVH_ServerName" name="txtTVH_ServerName" class="emby-input" is="emby-input" />
                    </div>
                    <div class="inputContainer">
                        <label for="txtHTTP_Port" class="inputLabel">HTTP Port</label>
                        <input type="text" id="txtHTTP_Port" name="txtHTTP_Port" class="emby-input" is="emby-input" />
                    </div>
                    <div class="inputContainer">
                        <label for="txtHTSP_Port" class="inputLabel">HTSP Port</label>
                        <input type="text" id="txtHTSP_Port" name="txtHTSP_Port" class="emby-input" is="emby-input" />
                    </div>
                    <div class="inputContainer">
                        <label for="txtWebRoot" class="inputLabel">Web Root</label>
                        <input type="text" id="txtWebRoot" name="txtWebRoot" class="emby-input" is="emby-input" />
                        <div class="fieldDescription">This path will be added to HOSTNAME:PORT on the end of the URL. It should be '/' if you don't have a custom setup.</div>
                    </div>
                    <div class="inputContainer">
                        <label for="txtUserName" class="inputLabel">Username</label>
                        <input type="text" id="txtUserName" name="txtUserName" class="emby-input" is="emby-input" />
                    </div>
                    <div class="inputContainer">
                        <label for="txtPassword" class="inputLabel">Password</label>
                        <input type="password" id="txtPassword" name="txtPassword" class="emby-input" is="emby-input" />
                    </div>
                    <div class="inputContainer">
                        <label for="txtPriority" class="inputLabel">Priority of Recordings</label>
                        <input type="text" id="txtPriority" name="txtPriority" class="emby-input" is="emby-input" />
                        <div class="fieldDescription">0 = Important, 1 = High, 2 = Normal, 3 = Low, 4 = Unimportant</div>
                    </div>
                    <div class="inputContainer">
                        <label for="txtProfile" class="inputLabel">Profile for Recordings</label>
                        <input type="text" id="txtProfile" name="txtProfile" class="emby-input" is="emby-input" />
                    </div>
                    <div class="selectContainer">
                        <label for="selChannelType" class="selectLabel">Use this channel type for channels tagged with Other</label>
                        <select id="selChannelType" is="emby-select" class="emby-select-withcolor emby-select">
                            <option>TV</option>
                            <option>Radio</option>
                            <option>Ignore</option>
                        </select>
                    </div>
                    <div class="checkboxContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="chkHideRecordingsChannel" is="emby-checkbox" />
                            <span>Hide TVHeadEnd Recordings channel</span>
                        </label>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="chkEnableSubsMaudios" is="emby-checkbox" />
                            <span>Enable live TV subtitles and multiple audio tracks (Experimental)</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">Note: Enabling this feature has security implications and will require a server restart. (TVH username and password will appear in server logs and will be transmitted in cleartext over the network)</div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="chkForceDeinterlace" is="emby-checkbox" />
                            <span>Force video deinterlacing for all channels and recordings. (Experimental)</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">Note: Changing this requires a server restart.</div>
                    </div>
                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block emby-button" data-theme="b">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var TVHclientConfigurationPageVar = {
                pluginUniqueId: "3fd018e5-5e78-4e58-b280-a0c068febee0"
            };

            document.querySelector('.TVHclientConfigurationPage').addEventListener('pageshow', function (event) {
                Dashboard.showLoadingMsg();
                var page = this;
                ApiClient.getPluginConfiguration(TVHclientConfigurationPageVar.pluginUniqueId).then(function(config) {
                    page.querySelector('#txtTVH_ServerName').value = config.TVH_ServerName || "";
                    page.querySelector('#txtHTTP_Port').value = config.HTTP_Port || "9981";
                    page.querySelector('#txtHTSP_Port').value = config.HTSP_Port || "9982";
                    page.querySelector('#txtWebRoot').value = config.WebRoot || "/";
                    page.querySelector('#txtUserName').value = config.Username || "";
                    page.querySelector('#txtPassword').value = config.Password || "";
                    page.querySelector('#txtPriority').value = config.Priority || "5";
                    page.querySelector('#txtProfile').value = config.Profile || "";
                    page.querySelector('#selChannelType').value = config.ChannelType || "Ignore";
                    page.querySelector('#chkHideRecordingsChannel').checked = config.HideRecordingsChannel || false;
                    page.querySelector('#chkEnableSubsMaudios').checked = config.EnableSubsMaudios || false;
                    page.querySelector('#chkForceDeinterlace').checked = config.ForceDeinterlace || false;
                    Dashboard.hideLoadingMsg();
                });
            });

            document.querySelector('.TVHclientConfigurationForm').addEventListener('submit', function (e) {
                Dashboard.showLoadingMsg();
                var form = this;
                ApiClient.getPluginConfiguration(TVHclientConfigurationPageVar.pluginUniqueId).then(function(config) {
                    config.TVH_ServerName = form.querySelector('#txtTVH_ServerName').value;
                    config.HTTP_Port = form.querySelector('#txtHTTP_Port').value;
                    config.HTSP_Port = form.querySelector('#txtHTSP_Port').value;
                    config.WebRoot = form.querySelector('#txtWebRoot').value;
                    config.Username = form.querySelector('#txtUserName').value;
                    config.Password = form.querySelector('#txtPassword').value;
                    config.Priority = form.querySelector('#txtPriority').value;
                    config.Profile = form.querySelector('#txtProfile').value;
                    config.ChannelType = form.querySelector('#selChannelType').value;
                    config.HideRecordingsChannel = form.querySelector('#chkHideRecordingsChannel').checked;
                    config.EnableSubsMaudios = form.querySelector('#chkEnableSubsMaudios').checked;
                    config.ForceDeinterlace = form.querySelector('#chkForceDeinterlace').checked;
                    ApiClient.updatePluginConfiguration(TVHclientConfigurationPageVar.pluginUniqueId, config).then(Dashboard.processPluginConfigurationUpdateResult);
                });
                return false;
            });
        </script>
    </div>
</body>

</html>
